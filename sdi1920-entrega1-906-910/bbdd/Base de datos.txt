CREATE TABLE empleado (
	idEmpleado INT NOT NULL ,
	nombreEmpleado VARCHAR(20),
	apellidosEmpleado VARCHAR(40),
	dni VARCHAR(9),
	cargo VARCHAR(20),
	correo VARCHAR(20),
	CONSTRAINT PK_EMPLEADO PRIMARY KEY (idEmpleado),
	CONSTRAINT CHK_CARGO CHECK (cargo IN ('medico' , 'enfermero'))
);

CREATE TABLE jornadaLaboral (
	idJornada INT NOT NULL,
	idEmpleado INT NOT NULL,
	fechaInicio TIMESTAMP,
	fechaFin TIMESTAMP,
	CONSTRAINT PK_JORNADA PRIMARY KEY (idJornada),
	CONSTRAINT FK_JORNADA FOREIGN KEY (idEmpleado) REFERENCES empleado (idEmpleado)
);

CREATE TABLE vacacion (
	idVacacion INT NOT NULL,
	idEmpleado INT NOT NULL,
	fechaInicio TIMESTAMP,
	fechaFin TIMESTAMP,
	CONSTRAINT PK_VACACION PRIMARY KEY (idVacacion),
	CONSTRAINT FK_VACACION FOREIGN KEY (idEmpleado) REFERENCES empleado (idEmpleado)
);

CREATE TABLE paciente (
	idPaciente INT NOT NULL,
	dni VARCHAR(9),
	nombrePaciente VARCHAR(20),
	apellidoPaciente VARCHAR(40),	
	telefono INT,
	CONSTRAINT PK_PACIENTE PRIMARY KEY (idPaciente)
);

CREATE TABLE historial (
	idHistorial INT NOT NULL,
	idPaciente INT NOT NULL,
	datos VARCHAR(255),
	prescripcion VARCHAR(255),
	procedimientos varchar(5000),
	diagnosticos varchar(5000),
	CONSTRAINT PK_HISTORIAL PRIMARY KEY (idHistorial),
	CONSTRAINT FK_HISTORIAL FOREIGN KEY (idPaciente) REFERENCES paciente (idPaciente)
);


CREATE TABLE cita (
	idCita INT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1),
	idPaciente INT NOT NULL,
	idEmpleado INT,
	urgente BOOLEAN,
	sala INT,
	fechaInicio TIMESTAMP,
	fechaFin TIMESTAMP,
	sintomas VARCHAR(255),
	acudir BOOLEAN,
	confirmada BOOLEAN,
	rechazada BOOLEAN,
	nombreContacto VARCHAR(20),
	apellidosContacto VARCHAR(40),
	telefonoContacto INT,
	informacionExtra VARCHAR(200),
	UNIQUE(idCita),
	CONSTRAINT PK_CITA PRIMARY KEY (idCita, idPaciente),
	CONSTRAINT FK_CITA_PACIENTE FOREIGN KEY (idPaciente) REFERENCES paciente (idPaciente),
	CONSTRAINT FK_CITA_EMPLEADO FOREIGN KEY (idEmpleado) REFERENCES empleado (idEmpleado),
);

CREATE TABLE prescripcion_cita (
	idprescripcion BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
	idCita INT NOT NULL,
	idPaciente INT NOT NULL,
	CONSTRAINT uq_CitaID UNIQUE (idCita),
	CONSTRAINT PK_PRESCRIPCION_CITA PRIMARY KEY (idprescripcion),
	CONSTRAINT FK_PRESCRIPCION_CITA FOREIGN KEY (idCita,idPaciente) REFERENCES cita (idCita,idPaciente)
);

CREATE TABLE prescripcion(
	id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1),
	tipo varchar(255), 
	cantidad int,
	dosis INT,
	dias INT NOT NULL,
	otros VARCHAR(255),
	idprescripcion int not null,
	CONSTRAINT PK_IDPRESC PRIMARY KEY (id),
	CONSTRAINT CHK_tipo CHECK (tipo IN ('medicamento' , 'actividad deportiva')),
	CONSTRAINT FK_PRESCRIPCION_PRESCRIPCIONCITA FOREIGN KEY (idPrescripcion) REFERENCES PRESCRIPCION_CITA (IDPRESCRIPCION)
);



CREATE TABLE antecedente(
	id int not null GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1),
	descripcion varchar(255),
	idhistorial int,
	CONSTRAINT PK_ID_ANT PRIMARY KEY (ID),
	CONSTRAINT FK_HISTORIAL_ANTECEDENTE FOREIGN KEY (idhistorial) REFERENCES HISTORIAL (idhistorial)
);

CREATE TABLE vacuna(
	id int not null GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1),
	idpaciente int,
	fechainicio date,
	fechafin date,
	vacuna varchar(255),
	CONSTRAINT PK_VACUNA PRIMARY KEY (ID),
	CONSTRAINT FK_VACUNA FOREIGN KEY (idpaciente) REFERENCES paciente(idpaciente)
);

CREATE TABLE diagnostico(
	idDiagnostico BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	codigo VARCHAR(50),
	descripcion VARCHAR(1024),
	diagnostico_padre BIGINT,
	CONSTRAINT PK_DIAGNOSTICO PRIMARY KEY (idDiagnostico),
	CONSTRAINT FK_DIAGNOSTICO FOREIGN KEY (diagnostico_padre) REFERENCES diagnostico (idDiagnostico)
);

CREATE TABLE diagnosticos_cita (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	idCita INT NOT NULL,
	idPaciente INT NOT NULL,
	idDiagnostico BIGINT,
	descripcion VARCHAR(1024),
	CONSTRAINT PK_DIAGNOSTICO_CITA PRIMARY KEY (id, idCita, idPaciente),
	CONSTRAINT FK_DIAGNOSTICO_CITA_ID FOREIGN KEY (idCita, idPaciente) REFERENCES cita (idCita, idPaciente),
	CONSTRAINT FK_DIAGNOSTICO_DIAGNOSTICO_ID FOREIGN KEY (idDiagnostico) REFERENCES diagnostico (idDiagnostico)
);

INSERT INTO empleado VALUES (1, 'Jaime', 'Lopez', '1', 'medico', 'jaime@uniovi.es');
INSERT INTO empleado VALUES (2, 'Luison', 'Hurle', '2', 'medico', 'luison@uniovi.es');
INSERT INTO empleado VALUES (3, 'Noe', 'Garcia', '3', 'enfermero', 'noe@uniovi.es');
INSERT INTO empleado VALUES (4, 'Andres', 'Garcia', '4', 'enfermero', 'andres@uniovi.es');

insert into paciente values ('1', '00112233', 'Luis Carlos','Hurle', 1);
insert into paciente values ('2', '12345678', 'Jaime', 'Fernandez Gonzalez', 2);
insert into paciente values ('3', '11223344', 'Jesus','Perez Noriega', 3);
insert into paciente values ('4', '55667788', 'Miguel','Orina de Chuck Norris', 4);

insert into historial (idhistorial, idpaciente, datos, PROCEDIMIENTOS) values ('1', '1', 'dolor rodilla', 'Fecha: Mon Dec 09 09:19:08 CET 2019\n---- Procedimiento: Vendaje\n---- Detalles: vendaje rodilla izq');
insert into historial (idhistorial, idpaciente, datos,PROCEDIMIENTOS) values ('2', '2', 'dolor cabeza','Fecha: Mon Dec 09 09:19:08 CET 2019\n---- Procedimiento: Vendaje\n---- Detalles: vendaje rodilla izq');
insert into historial (idhistorial, idpaciente, datos,PROCEDIMIENTOS) values ('3', '3', 'dolor brazo','Fecha: Mon Dec 09 09:19:08 CET 2019\n---- Procedimiento: Vendaje\n---- Detalles: vendaje rodilla izq');
insert into historial (idhistorial, idpaciente, datos,PROCEDIMIENTOS) values ('4', '4', 'herida','Fecha: Mon Dec 09 09:19:08 CET 2019\n---- Procedimiento: Vendaje\n---- Detalles: vendaje rodilla izq');

insert into cita (idpaciente, idempleado, urgente, sala, fechaInicio, fechafin, sintomas, confirmada, rechazada) values ('1', '1', true, '15', to_date('25-10-2019 00:00', 'DD-MM-YYYY HH:MM'), to_date('25-10-2019 00:00', 'DD-MM-YYYY HH:MM'), 'El paciente se encontraba mal debido a un traumatismo en la rodilla',true,false);
insert into cita (idpaciente, idempleado, urgente, sala, fechaInicio, fechafin, sintomas, confirmada, rechazada) values ('2','1', true, '1', to_date('20-10-2019 00:00', 'DD-MM-YYYY HH:MM'), to_date('20-10-2019 00:00', 'DD-MM-YYYY HH:MM'), 'El paciente vomit� durante la noche',false,false);
insert into cita (idpaciente, idempleado, urgente, sala, fechaInicio, fechafin, sintomas, confirmada, rechazada) values ('3','1', false,'2', to_date('25-10-2019 00:00', 'DD-MM-YYYY HH:MM'), to_date('25-10-2019 00:00', 'DD-MM-YYYY HH:MM'), 'Jugando a futbol, recibio una entrada',false,false);
insert into cita (idpaciente, idempleado, urgente, sala, fechaInicio, fechafin, sintomas, confirmada, rechazada) values ('4','1', false, '5', to_date('20-01-2020 00:00', 'DD-MM-YYYY HH:MM'), to_date('20-01-2020 00:00', 'DD-MM-YYYY HH:MM'), 'Montando en bici se cayo',false,false);

insert into PRESCRIPCION_cita (IDCITA, IDPACIENTE) values (1,1);
insert into PRESCRIPCION_cita (IDCITA, IDPACIENTE) values (2,2);
insert into PRESCRIPCION_cita (IDCITA, IDPACIENTE) values (3,3);
insert into PRESCRIPCION_cita (IDCITA, IDPACIENTE) values (4,4);

insert into prescripcion (tipo, cantidad, dosis, dias, otros,idprescripcion) values('medicamento', '3', '600', '7', 'reposo en cama',1);
insert into prescripcion (tipo, dias, otros,idprescripcion) values('actividad deportiva', '7', 'caminar un par de kilomemtros',1);
insert into prescripcion (tipo, dias, otros,idprescripcion) values('actividad deportiva', '7', 'montar en bici estatica',2);
insert into prescripcion (tipo, cantidad, dosis, dias, otros,idprescripcion) values('medicamento', '2', '300', '4', 'tomar despues de cada comida',2);
insert into prescripcion (tipo, cantidad, dosis, dias, otros,idprescripcion) values('medicamento', '1', '150', '7', 'tomar cada mañana',3);

insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('1','1','1');
insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('2','2','1');
insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('3','3','1');
insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('1','1','2');
insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('3','3','2');
insert into diagnosticos_cita(idCita,idPaciente,idDiagnostico) values('4','4','42488');